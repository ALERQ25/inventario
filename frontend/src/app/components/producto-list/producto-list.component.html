<div class="container">
  <div class="header">
    <h1>üè™ Sistema de Inventario</h1>
    <p>FastAPI + Angular + PostgreSQL</p>
  </div>

  <div class="content">
    <div class="form-container">
      <h2>{{ editando ? 'Editar Producto' : 'Nuevo Producto' }}</h2>
      
      <div *ngIf="errores.length > 0" class="error-message">
        <strong>‚ö†Ô∏è Errores de validaci√≥n:</strong>
        <ul class="error-list">
          <li *ngFor="let error of errores">{{ error }}</li>
        </ul>
      </div>

      <form (ngSubmit)="guardarProducto()">
        <div class="form-grid">
          <div class="form-group">
            <label>C√≥digo *</label>
            <input type="text" [(ngModel)]="productoForm.codigo" name="codigo" 
                   [disabled]="editando" required maxlength="50" placeholder="PROD001">
          </div>

          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" [(ngModel)]="productoForm.nombre" name="nombre" 
                   required maxlength="200" placeholder="Nombre del producto">
          </div>

          <div class="form-group">
            <label>Categor√≠a</label>
            <input type="text" [(ngModel)]="productoForm.categoria" name="categoria" 
                   maxlength="100" placeholder="Electr√≥nica, Accesorios, etc.">
          </div>

          <div class="form-group">
            <label>Cantidad *</label>
            <input type="number" [(ngModel)]="productoForm.cantidad" name="cantidad" 
                   required min="0" placeholder="0">
          </div>

          <div class="form-group">
            <label>Precio *</label>
            <input type="number" [(ngModel)]="productoForm.precio" name="precio" 
                   required min="0.01" step="0.01" placeholder="0.00">
          </div>
        </div>

        <div class="form-group">
          <label>Descripci√≥n</label>
          <textarea [(ngModel)]="productoForm.descripcion" name="descripcion" 
                    placeholder="Descripci√≥n detallada del producto..."></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancelar()" 
                  *ngIf="editando">Cancelar</button>
          <button type="submit" class="btn btn-primary">
            {{ editando ? 'üíæ Actualizar' : '‚ûï Crear' }} Producto
          </button>
        </div>
      </form>
    </div>

    <div class="table-container">
      <!-- ===== BUSCADOR DE PRODUCTOS ===== -->
    <div class="search-container">
      <div class="search-box">
        <div class="search-icon">
          <i class="bi bi-search"></i>
        </div>
        <input 
          type="text" 
          class="search-input"
          [(ngModel)]="terminoBusqueda"
          (input)="buscar()"
          placeholder="Buscar por c√≥digo, nombre, descripci√≥n o categor√≠a..."
          maxlength="100">
        <button 
          *ngIf="terminoBusqueda" 
          class="search-clear"
          (click)="limpiarBusqueda()"
          title="Limpiar b√∫squeda">
          <i class="bi bi-x-circle-fill"></i>
        </button>
      </div>
      <div class="search-info" *ngIf="terminoBusqueda">
        <span class="badge badge-info">
          {{ productosFiltrados.length }} resultado(s) encontrado(s)
        </span>
      </div>
    </div>

    <div class="table-container">
          <table *ngIf="productosFiltrados.length > 0">

        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let producto of obtenerProductosPaginados()">
            <td><strong>{{ producto.codigo }}</strong></td>
            <td>{{ producto.nombre }}</td>
            <td>{{ producto.categoria || 'Sin categor√≠a' }}</td>
            <td>
              <span [class]="'badge ' + obtenerEstadoStock(producto.cantidad)">
                {{ producto.cantidad }}
              </span>
            </td>
            <td>${{ producto.precio | number:'1.2-2' }}</td>
            <td>
              <div class="actions-cell">
                <button class="btn btn-warning btn-sm" (click)="editarProducto(producto)">
                  ‚úèÔ∏è Editar
                </button>
                <button class="btn btn-danger btn-sm" (click)="eliminarProducto(producto.id!)">
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- ===== CONTROLES DE PAGINACI√ìN ===== -->
      <div class="pagination-container" *ngIf="productosFiltrados.length > productosPorPagina">

        <div class="pagination-info">
          Mostrando 
          <strong>{{ (paginaActual - 1) * productosPorPagina + 1 }}</strong> 
          a 
          <strong>{{ Math.min(paginaActual * productosPorPagina, productos.length) }}</strong> 
          de 
          <strong>{{ productos.length }}</strong> 
          productos
        </div>

        <div class="pagination-controls">
          <!-- Bot√≥n Anterior -->
          <button 
            class="btn-pagination" 
            (click)="cambiarPagina(paginaActual - 1)"
            [disabled]="paginaActual === 1">
            ‚Üê Anterior
          </button>

          <!-- N√∫meros de p√°gina -->
          <button 
            *ngFor="let pagina of obtenerRangoPaginas()"
            class="btn-pagination"
            [class.active]="pagina === paginaActual"
            (click)="cambiarPagina(pagina)">
            {{ pagina }}
          </button>

          <!-- Bot√≥n Siguiente -->
          <button 
            class="btn-pagination" 
            (click)="cambiarPagina(paginaActual + 1)"
            [disabled]="paginaActual === totalPaginas">
            Siguiente ‚Üí
          </button>
        </div>
      </div>

<div *ngIf="productosFiltrados.length === 0 && !terminoBusqueda" class="empty-state">
        <div class="empty-state-icon">üì¶</div>
        <h3>No hay productos en el inventario</h3>
        <p>Comienza agregando tu primer producto usando el formulario arriba</p>
      </div>

      <div *ngIf="productosFiltrados.length === 0 && terminoBusqueda" class="empty-state">
        <div class="empty-state-icon">üîç</div>
        <h3>No se encontraron productos</h3>
        <p>No hay productos que coincidan con "{{ terminoBusqueda }}"</p>
        <button class="btn btn-secondary" (click)="limpiarBusqueda()">
          <i class="bi bi-arrow-counterclockwise"></i> Limpiar b√∫squeda
        </button>
      </div>
</div>